function postGetBook(a,b,c){$("#drop>li.active").index();$.post("/fn/onborrow",{keyName:$("#search-key").val(),way:"account",page:a,pageNum:b},function(d,e,f){console.log(d),addDataToHtml(d,a,b),c&&c(d,a,b),nowPageNum=parseInt(d.num/b)+1})}function addDataToHtml(a,b,c){for(var d=a.book,e=$("<tbody></tbody>"),f=0;f<d.length;f++)e.append(getTr(d[f],a.borrow[f],b*c+f+1));$("#results>tbody").replaceWith(e)}function getTr(a,b,c){var d=$("<tr></tr>"),e=[];e[0]=$("<td>"+c+"</td>"),e[1]=$('<td class="danger">'+b.account+"</td>"),e[2]=$('<td class="info">'+b.borrow_date.substr(0,10)+"</td>"),e[3]=$("<td>"+a.name+"</td>"),e[4]=$("<td>"+a.author+"</td>"),e[5]=$("<td>"+a.lib_id+"</td>"),e[6]=$("<td>"+a.isbn+"</td>"),e[7]=$("<td><a href='javascript:deleteBorrow("+b.id+","+a.id+")'' class='btn btn-danger btn-xs' data-id='"+b.id+"'>归还</a></td>");for(var c=0;c<e.length;c++)e[c].appendTo(d);return d}function transSort(a){for(var b={},c=0;c<a.length;c++)b[a[c].id]=a[c].name;return b}function initPagination(a,b,c){return a.num<c?void $("#page-row").css({display:"none"}):void $("#page-row").css({display:"block"})}function deleteBorrow(a,b){1!=isDelete&&(isDelete=!0,$.post("/admin/returnbookpost",{borrowId:a,bookId:b},function(b,c,d){isDelete=!1,"success"===b?(removeTr(a),layer.msg("归还成功")):layer.msg("归还失败")}))}function removeTr(a){$("tr:has(td a[data-id="+a+"])").remove()}$(function(){$("#drop>li").click(function(a){$("#drop>li").removeClass("active"),$(this).addClass("active"),$("#search-way>span:first").html($(this).text()+"&nbsp;")}),$("#search-key").bind("input propertychange",function(a){postGetBook(0,10,initPagination)}),$("#pre-page").click(function(){if(1==$("#page-num>a").text())return void layer.msg("已经是第一页了");var a=parseInt($("#page-num>a").text());$("#page-num>a").text(a-1),postGetBook(a-2,10,initPagination)}),$("#next-page").click(function(a){if(console.log(nowPageNum),$("#page-num>a").text()==nowPageNum)return void layer.msg("已经是最后一页了");var b=parseInt($("#page-num>a").text());$("#page-num>a").text(b+1),postGetBook(b,10,initPagination)}),postGetBook(0,10,initPagination)});var nowPageNum,isDelete=!1;