function postGetBook(a,b,c){var d=$("#drop>li.active").index(),e=["name","lib_id"];$.post("/fn/findbook",{keyName:$("#search-key").val(),way:e[d],page:a,pageNum:b},function(d,e,f){addDataToHtml(d,a,b),c&&c(d,a,b),nowPageNum=parseInt(d.num/b)+1})}function addDataToHtml(a,b,c){for(var d=a.book,e=$("<tbody></tbody>"),f=0;f<d.length;f++)e.append(getTr(d[f],transSort(a.sort),b*c+f+1));$("#results>tbody").replaceWith(e)}function getTr(a,b,c){var d=$("<tr></tr>"),e=[];e[0]=$("<td>"+c+"</td>"),e[1]=$("<td>"+a.name+"</td>"),e[2]=$("<td>"+a.author+"</td>"),e[3]=$("<td>"+a.lib_id+"</td>"),e[4]=$("<td>"+a.isbn+"</td>"),e[5]=$("<td><a href='http://localhost:3000/fn/editonebook?id="+a.id+"' class='btn btn-primary btn-xs' target='_blank'>编辑</a></td>"),e[6]=$("<td><a href='javascript:deleteBook("+a.id+")'' class='btn btn-danger btn-xs' data-id='"+a.id+"'>删除</a></td>");for(var c=0;c<e.length;c++)e[c].appendTo(d);return d}function transSort(a){for(var b={},c=0;c<a.length;c++)b[a[c].id]=a[c].name;return b}function initPagination(a,b,c){return a.num<c?void $("#page-row").css({display:"none"}):void $("#page-row").css({display:"block"})}function deleteBook(a){$.post("/fn/deletebook",{id:a},function(a,b,c){if("error1"==a)layer.msg("该本书外借中,无法删除");else if("error"==a)layer.msg("删除失败");else if("success"==a){layer.msg("删除成功");var d=parseInt($("#page-num>a").text());postGetBook(d-1,10,initPagination)}})}$(function(){$("#drop>li").click(function(a){$("#drop>li").removeClass("active"),$(this).addClass("active"),$("#search-way>span:first").html($(this).text()+"&nbsp;")}),$("#search-key").bind("input propertychange",function(a){postGetBook(0,10,initPagination)}),$("#pre-page").click(function(){if(1==$("#page-num>a").text())return void layer.msg("已经是第一页了");var a=parseInt($("#page-num>a").text());$("#page-num>a").text(a-1),postGetBook(a-2,10,initPagination)}),$("#next-page").click(function(a){if(console.log(nowPageNum),$("#page-num>a").text()==nowPageNum)return void layer.msg("已经是最后一页了");var b=parseInt($("#page-num>a").text());$("#page-num>a").text(b+1),postGetBook(b,10,initPagination)}),postGetBook(0,10,initPagination)});var nowPageNum;